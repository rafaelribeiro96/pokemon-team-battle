<div class="battle-container">
  <app-scoreboard
    [teamOneScore]="teamOneScore()"
    [teamTwoScore]="teamTwoScore()"
    [teamOneCount]="getActiveTeamOneCount()"
    [teamTwoCount]="getActiveTeamTwoCount()"
    [winner]="winner()">
  </app-scoreboard>

  <div class="battle-layout">
    <div class="team-column team-one" [class.winner]="winner() === 'Time 1'">
      <h3>Time 1</h3>
      <app-team-builder #teamOneBuilder [battleInProgress]="battleInProgress()" (teamChange)="setTeamOne($event)"></app-team-builder>
    </div>

    <div class="battle-arena">
      <app-battle-header></app-battle-header>

      <div *ngIf="battleInProgress()" class="current-battle">
        <h2>Turno: {{ turnNumber() }}</h2>
        <div class="battle-cards" *ngIf="currentBattle().p1 && currentBattle().p2">
          <app-pokemon-card
            [pokemon]="currentBattle().p1!"
            [isAttacking]="currentBattle().p1IsAttacking ?? false"
            [isDefending]="currentBattle().p1IsDefending ?? false">
          </app-pokemon-card>
          <div class="vs">VS</div>
          <app-pokemon-card
            [pokemon]="currentBattle().p2!"
            [isAttacking]="currentBattle().p2IsAttacking ?? false"
            [isDefending]="currentBattle().p2IsDefending ?? false">
          </app-pokemon-card>
        </div>
      </div>

      <div class="battle-controls">
        <button
          mat-raised-button
          color="accent"
          [disabled]="battleInProgress()"
          (click)="startBattle()"
        >
          Lutar!
        </button>
        <button
          mat-raised-button
          color="warn"
          *ngIf="battleEnded()"
          (click)="resetBattle()"
        >
          Reiniciar
        </button>
      </div>

      <app-battle-report *ngIf="battleLog().length > 0" [log]="battleLog()"></app-battle-report>
    </div>

    <div class="team-column team-two" [class.winner]="winner() === 'Time 2'">
      <h3>Time 2</h3>
      <app-team-builder #teamTwoBuilder [battleInProgress]="battleInProgress()" (teamChange)="setTeamTwo($event)"></app-team-builder>
    </div>
  </div>
</div>
